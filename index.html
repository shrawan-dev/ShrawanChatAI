<!DOCTYPE html>
<html lang="hi" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ShrawanChatAI AI</title>
<link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
/* --- THEMES --- */
:root[data-theme="dark"] {
    --bg-main: #131314; --sidebar-bg: #1e1f20; --input-bg: #1e1f20;
    --text-main: #e3e3e3; --text-sub: #c4c7c5; --accent-color: #8ab4f8;
    --msg-user-bg: #333537; --border-color: #3c4043;
}
:root[data-theme="light"] {
    --bg-main: #ffffff; --sidebar-bg: #f0f4f9; --input-bg: #f0f4f9;
    --text-main: #1f1f1f; --text-sub: #444746; --accent-color: #0b57d0;
    --msg-user-bg: #e3e3e3; --border-color: #e0e0e0;
}
:root[data-theme="blue"] {
    --bg-main: #0b141a; --sidebar-bg: #111b21; --input-bg: #2a3942;
    --text-main: #e9edef; --text-sub: #8696a0; --accent-color: #53bdeb;
    --msg-user-bg: #005c4b; --border-color: #2a3942;
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Google Sans', 'Segoe UI', sans-serif; }
body { background: var(--bg-main); color: var(--text-main); height: 100dvh; overflow: hidden; display: flex; transition: 0.3s; }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }

/* SIDEBAR */
.sidebar { position: fixed; left: -300px; top: 0; width: 280px; height: 100%; background: var(--sidebar-bg); transition: left 0.3s ease; z-index: 1000; padding: 15px; display: flex; flex-direction: column; border-right: 1px solid var(--border-color); }
.sidebar.active { left: 0; }
.sidebar-header { display: flex; align-items: center; margin-bottom: 20px; }
.btn-new { background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-main); padding: 10px 18px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-left: 10px; font-size: 14px; transition: 0.2s; font-weight: 500; }
.btn-new:hover { background: var(--border-color); }

.history-list { flex: 1; overflow-y: auto; margin-top: 10px; }
.history-item { padding: 12px; border-radius: 8px; font-size: 14px; cursor: pointer; color: var(--text-sub); margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.history-item:hover { background: var(--border-color); color: var(--text-main); }

.theme-selector { margin-top: auto; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); margin-bottom: 15px; }
.theme-btns { display: flex; gap: 5px; }
.theme-btn { flex: 1; padding: 8px; border: 1px solid var(--border-color); background: var(--bg-main); color: var(--text-main); border-radius: 8px; cursor: pointer; font-size: 12px; transition: 0.2s; }
.theme-btn:hover, .theme-btn.active { border-color: var(--accent-color); color: var(--accent-color); }
.settings-btn { background: transparent; color: var(--text-main); border: 1px solid var(--border-color); padding: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; transition: 0.2s; }

/* MAIN STAGE */
.main-stage { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
.icon-btn { color: var(--text-sub); background: none; border: none; cursor: pointer; padding: 8px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
.icon-btn:hover { background: var(--border-color); color: var(--text-main); }

.viewport { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 0 20px 20px 20px; overflow-y: auto; scroll-behavior: smooth; }

/* 10 Animated Icons + Fireball */
.cool-animations { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; max-width: 600px; }
.anim-icon { font-size: 35px; animation: floatAnim 2s infinite alternate ease-in-out; filter: drop-shadow(0 0 10px rgba(255,100,0,0.5)); }
.anim-icon:nth-child(even) { animation-direction: alternate-reverse; animation-duration: 2.5s; }
.anim-icon:nth-child(3n) { animation-delay: 0.3s; }
@keyframes floatAnim { 0% { transform: translateY(0px) scale(1); } 100% { transform: translateY(-15px) scale(1.2); filter: drop-shadow(0 0 20px rgba(255,0,0,0.8)); } }

.welcome-screen { width: 100%; max-width: 800px; margin-top: 5vh; text-align: center; }
.gradient-text { font-size: clamp(36px, 6vw, 56px); font-weight: bold; background: linear-gradient(74deg, #4285f4, #9b72cb, #d96570, #fbbc04, #4285f4); background-size: 400% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: gradientMove 5s ease infinite; }
@keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

#chat-flow { width: 100%; max-width: 800px; display: none; flex-direction: column; gap: 24px; padding-bottom: 120px; padding-top: 20px; }
.msg-container { display: flex; flex-direction: column; width: 100%; }
.msg { font-size: 16px; line-height: 1.6; word-wrap: break-word; }
.user-msg { align-self: flex-end; background: var(--msg-user-bg); padding: 12px 20px; border-radius: 24px 24px 4px 24px; color: var(--text-main); max-width: 85%; }
.bot-msg { align-self: flex-start; color: var(--text-main); max-width: 100%; padding: 0 10px; }
.chat-image { max-width: 100%; border-radius: 12px; margin-top: 10px; display: block; }
.typing { color: var(--accent-color); font-style: italic; animation: pulse 1s infinite; }

/* Control Buttons */
.msg-controls { display: flex; gap: 8px; margin-top: 5px; }
.msg-action-btn { background: transparent; color: var(--text-sub); border: none; cursor: pointer; padding: 6px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
.msg-action-btn:hover { background: var(--border-color); color: var(--text-main); }

/* Illegal Warning Animation */
.illegal-warning { color: #ff3b30; font-weight: bold; font-size: 22px; text-align: center; background: rgba(255, 0, 0, 0.1); padding: 15px; border-radius: 10px; border: 2px solid #ff3b30; animation: shakeDanger 0.3s infinite; text-shadow: 0 0 10px rgba(255,0,0,0.5); }
@keyframes shakeDanger { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

/* BOTTOM NAV */
.bottom-nav { position: absolute; bottom: 0; left: 0; width: 100%; display: flex; flex-direction: column; align-items: center; padding: 20px; background: linear-gradient(to top, var(--bg-main) 70%, transparent); }
#image-preview-container { display: none; width: 100%; max-width: 800px; margin-bottom: 10px; position: relative; }
#image-preview { height: 60px; border-radius: 8px; border: 2px solid var(--border-color); }
.remove-img-btn { position: absolute; top: -8px; left: 65px; background: #d93025; color: white; border: none; border-radius: 50%; width: 22px; height: 22px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; font-size: 12px; }

.input-container { background: var(--input-bg); border-radius: 30px; padding: 8px 12px; display: flex; align-items: center; gap: 6px; width: 100%; max-width: 800px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: 1px solid var(--border-color); }
#user-input { flex: 1; min-width: 0; background: transparent; border: none; color: var(--text-main); outline: none; font-size: 16px; padding: 10px; }

/* MODAL */
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
.modal-box { background: var(--sidebar-bg); padding: 25px; border-radius: 16px; width: 90%; max-width: 400px; border: 1px solid var(--border-color); }
.modal-input { width: 100%; padding: 12px; margin-bottom: 20px; background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-main); border-radius: 8px; outline: none; }
.modal-btn { background: var(--accent-color); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }

@keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
</style>
</head>
<body>

<div id="settings-modal" class="modal-overlay">
<div class="modal-box">
<h2 style="text-align: center; margin-bottom: 20px;">‚öôÔ∏è Setup</h2>
<label style="font-size: 13px; color: var(--text-sub);">OpenRouter API Key:</label>
<input type="password" id="api-key-input" class="modal-input" placeholder="sk-or-v1-...">
<label style="font-size: 13px; color: var(--text-sub);">Model:</label>
<input type="text" id="model-input" class="modal-input" value="google/gemini-2.0-flash-lite-preview-02-05:free">
<button class="modal-btn" onclick="saveSettings()">Start Chatting Fast üöÄ</button>
</div>
</div>

<aside id="sidebar" class="sidebar">
<div class="sidebar-header">
<button class="icon-btn" onclick="toggleSidebar()"><span class="material-icons">menu</span></button>
<button class="btn-new" onclick="location.reload()"><span class="material-icons">add</span> New chat</button>
</div>
<div class="history-list" id="history-items"></div>

<div class="theme-selector">
<p style="font-size: 12px; color: var(--text-sub); margin-bottom:8px;">Theme</p>
<div class="theme-btns">
<button class="theme-btn" id="btn-theme-dark" onclick="setTheme('dark')">Dark</button>
<button class="theme-btn" id="btn-theme-light" onclick="setTheme('light')">Light</button>
<button class="theme-btn" id="btn-theme-blue" onclick="setTheme('blue')">Blue</button>
</div>
</div>

<button class="settings-btn" onclick="openSettings()"><span class="material-icons">settings</span> Settings</button>
</aside>

<div class="main-stage">
<header>
<button class="icon-btn" onclick="toggleSidebar()"><span class="material-icons">menu</span></button>
</header>

<div class="viewport">
<div id="welcome-ui" class="welcome-screen">
<div class="cool-animations">
    <span class="anim-icon">üî•</span>
    <span class="anim-icon">üöÄ</span>
    <span class="anim-icon">üí°</span>
    <span class="anim-icon">ü§ñ</span>
    <span class="anim-icon">‚ú®</span>
    <span class="anim-icon">üíª</span>
    <span class="anim-icon">üìà</span>
    <span class="anim-icon">üéØ</span>
    <span class="anim-icon">‚ö°</span>
    <span class="anim-icon">üß†</span>
</div>
<h1 class="gradient-text">I Am ShrawanChatAI</h1>
<p style="color: var(--text-sub); font-size: 16px; margin-top: 15px; font-weight: 500;">YouTube Expert ‚Ä¢ Fast Vision AI ‚Ä¢ Smart Assistant</p>
</div>
<div id="chat-flow"></div>
</div>

<div class="bottom-nav">
<div id="image-preview-container">
<button class="remove-img-btn" onclick="removeImage()">‚úñ</button>
<img id="image-preview" src="" alt="preview">
</div>

<div class="input-container">
<input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
<button class="icon-btn" onclick="document.getElementById('file-input').click()" title="Attach Photo/File">
<span class="material-icons">add_photo_alternate</span>
</button>

<input type="text" id="user-input" placeholder="Message ShrawanChatAI..." onkeypress="if(event.key==='Enter') startChat()">

<button class="icon-btn" id="mic-btn" onclick="startVoiceTyping()" title="Tap to Speak">
<span class="material-icons">mic</span>
</button>

<button class="icon-btn" onclick="startChat()">
<span class="material-icons" style="color: var(--accent-color);">send</span>
</button>
</div>
</div>
</div>

<script>
let currentApiKey = localStorage.getItem('rc_apikey') || "";
let currentModel = localStorage.getItem('rc_model') || "google/gemini-2.0-flash-lite-preview-02-05:free";
let currentTheme = localStorage.getItem('rc_theme') || "dark";
let currentBase64Image = null;

// Audio Variables
let systemVoices = [];
let activeSpeakBtn = null;
let isVoicePaused = false;
let currentUtterance = null;
window.speechSynthesis.onvoiceschanged = () => { systemVoices = window.speechSynthesis.getVoices(); };

window.onload = function() {
    if (!currentApiKey) openSettings();
    systemVoices = window.speechSynthesis.getVoices();
    setTheme(currentTheme);
};

function setTheme(theme) {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('rc_theme', theme);
    document.getElementById('btn-theme-dark').classList.remove('active');
    document.getElementById('btn-theme-light').classList.remove('active');
    document.getElementById('btn-theme-blue').classList.remove('active');
    document.getElementById('btn-theme-' + theme).classList.add('active');
}

function openSettings() {
    document.getElementById('api-key-input').value = currentApiKey;
    document.getElementById('model-input').value = currentModel;
    document.getElementById('settings-modal').style.display = 'flex';
    toggleSidebar(false);
}

function saveSettings() {
    currentApiKey = document.getElementById('api-key-input').value.trim();
    currentModel = document.getElementById('model-input').value.trim();
    localStorage.setItem('rc_apikey', currentApiKey);
    localStorage.setItem('rc_model', currentModel);
    document.getElementById('settings-modal').style.display = 'none';
}

function toggleSidebar(force) {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('active', force ?? !sidebar.classList.contains('active'));
}

// STT (Voice Typing)
function startVoiceTyping() {
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) { alert("Browser voice typing support nahi karta."); return; }
    
    const micBtn = document.getElementById('mic-btn');
    const recognition = new SpeechRecognition();
    recognition.lang = 'hi-IN';
    recognition.interimResults = false;

    recognition.onstart = () => { micBtn.style.color = '#d93025'; document.getElementById('user-input').placeholder = "Sun raha hoon..."; };
    recognition.onresult = (event) => {
        document.getElementById('user-input').value = event.results[0][0].transcript;
        micBtn.style.color = 'var(--text-sub)';
        document.getElementById('user-input').placeholder = "Message ShrawanChatAI...";
        startChat();
    };
    recognition.onerror = () => { micBtn.style.color = 'var(--text-sub)'; document.getElementById('user-input').placeholder = "Message ShrawanChatAI..."; };
    recognition.start();
}

function handleImageUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            currentBase64Image = e.target.result;
            document.getElementById('image-preview').src = currentBase64Image;
            document.getElementById('image-preview-container').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}

function removeImage() {
    currentBase64Image = null;
    document.getElementById('image-preview-container').style.display = 'none';
    document.getElementById('file-input').value = "";
}

// MAIN CHAT LOGIC
async function startChat() {
    if (!currentApiKey) { openSettings(); return; }
    const input = document.getElementById('user-input');
    const text = input.value.trim();
    if (!text && !currentBase64Image) return;

    input.blur();
    document.getElementById('welcome-ui').style.display = 'none';
    const chatFlow = document.getElementById('chat-flow');
    chatFlow.style.display = 'flex';

    // Fast UI Append
    const userContainer = document.createElement('div');
    userContainer.className = 'msg-container user-msg';
    if(text) userContainer.innerHTML += `<div class="msg">${text}</div>`;
    if(currentBase64Image) userContainer.innerHTML += `<img src="${currentBase64Image}" class="chat-image" style="width:200px;">`;
    chatFlow.appendChild(userContainer);
    input.value = '';

    const histItem = document.createElement('div');
    histItem.className = 'history-item';
    histItem.innerText = text ? text.substring(0, 25) + "..." : "File/Photo attached...";
    document.getElementById('history-items').prepend(histItem);

    const botContainer = document.createElement('div');
    botContainer.className = 'msg-container bot-msg';
    botContainer.innerHTML = `<div class="msg"><span class="typing">Thinking very fast... ‚ö°</span></div>`;
    chatFlow.appendChild(botContainer);
    scrollToBottom();

    // SUPER SYSTEM PROMPT
    let systemInstruction = `You are ShrawanChatAI, an advanced superfast AI created by Shrawan Ji.
You are an absolute YouTube Expert. If the user asks for YouTube help, provide extremely professional SEO, viral trending titles, highly engaging descriptions, and trending tags separated by commas.
CRITICAL INSTRUCTION 1: You must use lots of relevant EMOJIS in every single sentence you generate. Match the emojis with the words.
CRITICAL INSTRUCTION 2: If the user asks anything illegal, adult, harmful, unethical, or dangerous, DO NOT fulfill the request. Instead, you MUST reply EXACTLY with this exact HTML block and nothing else:
<div class="illegal-warning">üö´ PITAOGE DIMAK SAHI HO JAYEGA <br><br> YOU WILL BE BEATEN, YOUR MIND WILL BE FIXED üö´</div>
If the user uploads an image, analyze it like a high-level vision AI and answer perfectly.`;

    let apiMessages = [{ "role": "system", "content": systemInstruction }];
    if(currentBase64Image) {
        apiMessages.push({ "role": "user", "content": [ { "type": "text", "text": text || "Please analyze this attached image." }, { "type": "image_url", "image_url": { "url": currentBase64Image } } ] });
    } else {
        apiMessages.push({ "role": "user", "content": text });
    }
    removeImage();

    try {
        const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
            method: "POST",
            headers: { "Authorization": `Bearer ${currentApiKey}`, "Content-Type": "application/json" },
            body: JSON.stringify({ "model": currentModel, "messages": apiMessages, "max_tokens": 8000 })
        });
        const data = await response.json();
        if (data.choices?.[0]?.message?.content) {
            let reply = data.choices[0].message.content;
            
            // Render text
            botContainer.innerHTML = `<div class="msg">${reply.replace(/\n/g, '<br>')}</div>`;
            
            // Setup Text-to-Speech
            let cleanSpeakText = reply.replace(/<[^>]*>?/gm, '').replace(/[\*\#\_]/g, '');
            if(!reply.includes('illegal-warning')) {
                addTTSControls(botContainer, cleanSpeakText);
            }
            scrollToBottom();
        } else {
            botContainer.innerHTML = "<div class='msg' style='color:#d93025;'>‚ö†Ô∏è Model Error. Try again.</div>";
        }
    } catch (err) { 
        botContainer.innerHTML = "<div class='msg' style='color:#d93025;'>‚ö†Ô∏è Network issue. Check your connection.</div>"; 
    }
}

function scrollToBottom() {
    const viewport = document.querySelector('.viewport');
    viewport.scrollTop = viewport.scrollHeight;
}

// TEXT TO SPEECH CONTROLS (Pause/Resume Fix)
function addTTSControls(containerElement, textToSpeak) {
    const controlsDiv = document.createElement('div');
    controlsDiv.className = 'msg-controls';
    
    const speakBtn = document.createElement('button');
    speakBtn.className = 'msg-action-btn';
    speakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">volume_up</span>';
    speakBtn.title = "Read Aloud";
    
    const copyBtn = document.createElement('button');
    copyBtn.className = 'msg-action-btn';
    copyBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">content_copy</span>';
    copyBtn.onclick = () => { navigator.clipboard.writeText(textToSpeak); alert("Copied! üìã"); };

    speakBtn.onclick = () => {
        if (window.speechSynthesis.speaking && activeSpeakBtn === speakBtn && !isVoicePaused) {
            window.speechSynthesis.pause(); isVoicePaused = true;
            speakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">play_arrow</span>';
            return;
        }
        if (isVoicePaused && activeSpeakBtn === speakBtn) {
            window.speechSynthesis.resume(); isVoicePaused = false;
            speakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">pause</span>';
            return;
        }
        
        window.speechSynthesis.cancel(); 
        if(activeSpeakBtn) activeSpeakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">volume_up</span>';
        
        activeSpeakBtn = speakBtn;
        isVoicePaused = false;
        currentUtterance = new SpeechSynthesisUtterance(textToSpeak);
        currentUtterance.lang = 'hi-IN';
        currentUtterance.rate = 1.1;
        
        currentUtterance.onstart = () => speakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">pause</span>';
        currentUtterance.onend = () => { speakBtn.innerHTML = '<span class="material-icons" style="font-size:18px;">volume_up</span>'; activeSpeakBtn = null; };
        currentUtterance.onerror = currentUtterance.onend;
        
        window.speechSynthesis.speak(currentUtterance);
    };
    
    controlsDiv.appendChild(speakBtn);
    controlsDiv.appendChild(copyBtn);
    containerElement.appendChild(controlsDiv);
}
</script>
</body>
</html>
