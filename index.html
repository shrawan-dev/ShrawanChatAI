<!DOCTYPE html>
<html lang="hi" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ShrawanChatAI Ultimate Professional</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* --- THEMES --- */
        :root[data-theme="dark"] {
            --bg-main: #0b0b0d; --sidebar-bg: #161719; --input-bg: #1e1f21;
            --text-main: #e3e3e3; --text-sub: #9aa0a6; --accent-color: #3b82f6;
            --msg-user-bg: #2d2e30; --border-color: #333333; --menu-hover: #202124;
            --card-bg: #161719; --modal-bg: #1c1d1f; --code-bg: #000000;
        }
        :root[data-theme="light"] {
            --bg-main: #ffffff; --sidebar-bg: #f5f5f5; --input-bg: #ffffff;
            --text-main: #1f1f1f; --text-sub: #5f6368; --accent-color: #2563eb;
            --msg-user-bg: #f3f4f6; --border-color: #e5e7eb; --menu-hover: #e8eaed;
            --card-bg: #ffffff; --modal-bg: #ffffff; --code-bg: #f8f9fa;
        }
        :root[data-theme="blue"] {
            --bg-main: #050a0f; --sidebar-bg: #0d1621; --input-bg: #122030;
            --text-main: #e8eaed; --text-sub: #8696a0; --accent-color: #4db8ff;
            --msg-user-bg: #004d40; --border-color: #1f3a5f; --menu-hover: #15273b;
            --card-bg: #122030; --modal-bg: #0d1621; --code-bg: #03060a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg-main); color: var(--text-main); height: 100dvh; display: flex; overflow: hidden; transition: 0.3s; }
        .hidden { display: none !important; }

        /* --- UI COMPONENTS --- */
        input, textarea, select { background: var(--input-bg); border: 1px solid var(--border-color); color: var(--text-main); padding: 12px; border-radius: 8px; outline: none; width: 100%; font-size: 14px; transition: border 0.2s; resize: none; }
        input:focus, textarea:focus { border-color: var(--accent-color); }
        button { cursor: pointer; font-family: 'Inter', sans-serif; }
        .primary-btn { background: var(--accent-color); color: #fff; border: none; padding: 10px 20px; border-radius: 6px; font-weight: 600; font-size: 14px; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .primary-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .icon-btn { background: transparent; border: none; color: var(--text-sub); padding: 8px; border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .icon-btn:hover { background: var(--menu-hover); color: var(--text-main); }

        /* --- SIDEBAR --- */
        .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6); z-index: 999; backdrop-filter: blur(2px); }
        .sidebar-overlay.active { display: block; }
        .sidebar { position: fixed; left: -300px; width: 280px; height: 100%; background: var(--sidebar-bg); transition: 0.3s; z-index: 1000; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; padding: 20px; }
        .sidebar.active { left: 0; }
        .sidebar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .brand-title { font-size: 20px; font-weight: 700; color: var(--accent-color); }
        
        .btn-new-chat { background: var(--bg-main); border: 1px solid var(--border-color); color: var(--text-main); padding: 12px; border-radius: 8px; display: flex; align-items: center; gap: 10px; margin-bottom: 20px; font-weight: 500; transition: 0.2s; width: 100%; }
        .btn-new-chat:hover { border-color: var(--accent-color); }
        
        .history-section { flex: 1; overflow-y: auto; margin-bottom: 20px; }
        .history-label { font-size: 11px; color: var(--text-sub); font-weight: 600; margin-bottom: 10px; letter-spacing: 0.5px; text-transform: uppercase; }
        .history-item { padding: 10px; border-radius: 6px; font-size: 13px; color: var(--text-main); cursor: pointer; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: flex; align-items: center; gap: 10px; }
        .history-item:hover { background: var(--menu-hover); }

        .theme-selector { border-top: 1px solid var(--border-color); padding-top: 15px; }
        .theme-btns { display: flex; gap: 8px; margin-top: 10px; }
        .theme-btn { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--input-bg); color: var(--text-sub); font-size: 12px; font-weight: 500; }
        .theme-btn.active { border-color: var(--accent-color); color: var(--accent-color); background: var(--bg-main); }

        /* --- MAIN CONTENT & HEADER --- */
        .main-content { flex: 1; display: flex; flex-direction: column; height: 100%; position: relative; }
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .header-right { display: flex; align-items: center; gap: 12px; }
        .model-selector { padding: 8px 12px; border-radius: 6px; font-size: 13px; font-weight: 500; max-width: 150px; cursor: pointer; }
        
        .profile-pic-small { width: 36px; height: 36px; border-radius: 50%; border: 2px solid var(--border-color); cursor: pointer; object-fit: cover; }
        .profile-pic-small:hover { border-color: var(--accent-color); }

        /* --- PROFILE MENU --- */
        .profile-menu { position: absolute; top: 60px; right: 20px; background: var(--modal-bg); border: 1px solid var(--border-color); border-radius: 12px; width: 260px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: none; z-index: 1100; overflow: hidden; animation: fadeIn 0.2s; }
        .profile-header { padding: 20px; text-align: center; border-bottom: 1px solid var(--border-color); background: var(--sidebar-bg); }
        .profile-pic-large { width: 60px; height: 60px; border-radius: 50%; border: 2px solid var(--accent-color); margin-bottom: 10px; }
        .profile-name { font-weight: 600; font-size: 15px; margin-bottom: 4px; }
        .profile-email { color: var(--text-sub); font-size: 12px; margin-bottom: 15px; }
        .login-btn { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid var(--accent-color); color: var(--accent-color); background: transparent; font-weight: 600; font-size: 13px; }
        .login-btn:hover { background: var(--accent-color); color: #fff; }
        .profile-links { list-style: none; padding: 10px 0; }
        .profile-links li { padding: 12px 20px; display: flex; align-items: center; gap: 15px; color: var(--text-main); cursor: pointer; font-size: 13px; }
        .profile-links li:hover { background: var(--menu-hover); }

        /* --- DASHBOARD HERO --- */
        .viewport { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; align-items: center; scroll-behavior: smooth; }
        .hero-section { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 60vh; text-align: center; width: 100%; max-width: 900px; }
        .shrawan-title { font-size: clamp(30px, 5vw, 48px); font-weight: 800; background: linear-gradient(45deg, var(--accent-color), #9b72cb, #d96570); background-size: 200%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; animation: flow 5s ease infinite; margin-bottom: 10px; }
        @keyframes flow { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .action-cards-container { display: flex; gap: 15px; margin-top: 40px; width: 100%; justify-content: center; flex-wrap: wrap; }
        .action-card { background: var(--card-bg); border: 1px solid var(--border-color); padding: 20px; border-radius: 16px; display: flex; flex-direction: column; align-items: center; text-align: center; gap: 12px; cursor: pointer; transition: 0.3s; flex: 1 1 160px; max-width: 200px; }
        .action-card:hover { border-color: var(--accent-color); transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .action-card-icon { font-size: 28px; color: var(--accent-color); background: var(--menu-hover); padding: 12px; border-radius: 50%; }
        .action-card-text { font-size: 14px; font-weight: 600; color: var(--text-main); }
        .action-card-subtext { font-size: 11px; color: var(--text-sub); }

        /* --- CHAT FLOW & MARKDOWN --- */
        #chat-flow { width: 100%; max-width: 850px; display: none; flex-direction: column; gap: 24px; padding-bottom: 160px; }
        .msg-row { display: flex; gap: 15px; width: 100%; animation: fadeIn 0.3s ease; }
        .msg-row.user { justify-content: flex-end; }
        .msg-bubble { padding: 14px 18px; font-size: 15px; line-height: 1.6; max-width: 85%; border-radius: 16px; }
        .msg-row.user .msg-bubble { background: var(--msg-user-bg); color: var(--text-main); border-bottom-right-radius: 4px; }
        .msg-row.bot .msg-bubble { background: var(--card-bg); border: 1px solid var(--border-color); border-bottom-left-radius: 4px; width: 100%; max-width: 100%; overflow-x: auto; }
        
        .msg-bubble p { margin-bottom: 12px; }
        .msg-bubble p:last-child { margin-bottom: 0; }
        .msg-bubble h1, .msg-bubble h2, .msg-bubble h3 { margin: 16px 0 10px 0; font-weight: 600; color: var(--text-main); }
        .msg-bubble ul, .msg-bubble ol { margin-bottom: 12px; padding-left: 20px; }
        .msg-bubble li { margin-bottom: 6px; }
        .msg-bubble pre { background: var(--code-bg); padding: 15px; border-radius: 8px; overflow-x: auto; margin-bottom: 12px; border: 1px solid var(--border-color); }
        .msg-bubble code { font-family: monospace; background: var(--code-bg); padding: 2px 4px; border-radius: 4px; font-size: 13px; color: #ff7b72; }
        .msg-bubble pre code { color: var(--text-main); background: transparent; padding: 0; }
        .msg-bubble table { width: 100%; border-collapse: collapse; margin-bottom: 12px; font-size: 14px; }
        .msg-bubble th, .msg-bubble td { border: 1px solid var(--border-color); padding: 10px; text-align: left; }
        .msg-bubble th { background: var(--menu-hover); font-weight: 600; }
        .msg-bubble img { max-width: 100%; border-radius: 8px; margin-top: 10px; border: 1px solid var(--border-color); }

        /* --- INPUT BAR --- */
        .bottom-bar { position: fixed; bottom: 0; width: 100%; padding: 0 20px 20px; background: linear-gradient(to top, var(--bg-main) 70%, transparent); display: flex; flex-direction: column; align-items: center; z-index: 100; pointer-events: none; }
        .input-box-container { width: 100%; max-width: 850px; position: relative; pointer-events: auto; }
        #preview-box { position: absolute; bottom: 100%; left: 20px; margin-bottom: 10px; background: var(--card-bg); padding: 5px; border-radius: 8px; border: 1px solid var(--border-color); display: none; }
        #preview-img { height: 60px; border-radius: 6px; }
        .input-box { background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 20px; display: flex; align-items: flex-end; padding: 10px 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); transition: 0.3s; }
        .input-box:focus-within { border-color: var(--accent-color); }
        #user-input { flex: 1; background: transparent; border: none; padding: 8px; font-size: 15px; max-height: 150px; overflow-y: auto; color: var(--text-main); }
        .input-actions { display: flex; align-items: center; gap: 8px; padding-bottom: 4px; }

        /* --- MODALS (OS MAC STYLE) --- */
        .modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center; backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.2s; }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-card { background: var(--modal-bg); border-radius: 12px; border: 1px solid var(--border-color); width: 90%; max-width: 550px; display: flex; flex-direction: column; box-shadow: 0 20px 50px rgba(0,0,0,0.5); transition: all 0.3s cubic-bezier(0.2, 0, 0, 1); position: relative; max-height: 90vh; }
        
        .modal-card.maximized { width: 100% !important; max-width: 100% !important; height: 100vh !important; max-height: 100vh !important; border-radius: 0 !important; top: 0; left: 0; }
        .modal-card.minimized { height: 45px !important; overflow: hidden; align-self: flex-end; margin-bottom: 0; border-radius: 12px 12px 0 0; width: 300px; }

        .modal-header { padding: 12px 16px; border-bottom: 1px solid var(--border-color); display: flex; align-items: center; background: var(--sidebar-bg); border-radius: 12px 12px 0 0; }
        .modal-card.maximized .modal-header { border-radius: 0; }
        .window-controls { display: flex; gap: 8px; margin-right: 15px; }
        .win-btn { width: 12px; height: 12px; border-radius: 50%; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; position: relative; }
        .win-btn span { font-size: 10px; opacity: 0; color: #000; transition: 0.2s; }
        .window-controls:hover .win-btn span { opacity: 0.6; }
        .win-close { background: #ff5f56; } .win-min { background: #ffbd2e; } .win-max { background: #27c93f; }
        
        .modal-title { font-size: 14px; font-weight: 600; color: var(--text-main); flex: 1; text-align: center; margin-right: 50px; }
        .modal-body { padding: 25px; overflow-y: auto; flex: 1; }
        .modal-footer { padding: 15px 25px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; background: var(--sidebar-bg); border-radius: 0 0 12px 12px; }

        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: var(--text-main); }

        /* Pricing Table */
        .pricing-grid { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .price-card { background: var(--input-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 25px; flex: 1 1 200px; max-width: 260px; display: flex; flex-direction: column; position: relative; }
        .price-card.premium { border-color: var(--accent-color); box-shadow: 0 0 20px rgba(var(--accent-color-rgb), 0.15); }
        .popular-tag { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: var(--accent-color); color: #fff; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; }
        .plan-name { font-size: 20px; font-weight: 700; margin-bottom: 5px; }
        .plan-price { font-size: 32px; font-weight: 800; margin-bottom: 20px; }
        .plan-features { list-style: none; margin-bottom: 25px; flex: 1; }
        .plan-features li { display: flex; align-items: center; gap: 10px; margin-bottom: 12px; font-size: 13px; color: var(--text-sub); }
        .plan-btn { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background: transparent; color: var(--text-main); font-weight: 600; }
        .price-card.premium .plan-btn { background: var(--accent-color); border-color: var(--accent-color); color: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div id="settings-modal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('settings-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('settings-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('settings-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">System Settings</div>
        </div>
        <div class="modal-body">
            <div class="form-group"><label class="form-label">Primary API Key (OpenRouter/Gemini)</label><input type="password" id="api-key-1" placeholder="sk-or-v1-..."></div>
            <div class="form-group"><label class="form-label">Fallback API Key</label><input type="password" id="api-key-2" placeholder="Optional"></div>
            <div class="form-group">
                <label class="form-label">Models Configuration</label>
                <input type="text" id="model-1" value="google/gemini-2.0-flash-lite-preview-02-05:free" style="margin-bottom:8px;">
                <input type="text" id="model-2" placeholder="Model 2" style="margin-bottom:8px;">
                <input type="text" id="model-3" placeholder="Model 3">
            </div>
        </div>
        <div class="modal-footer">
            <button class="primary-btn" onclick="saveSettings()">Save & Apply</button>
        </div>
    </div>
</div>

<div id="user-info-modal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('user-info-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('user-info-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('user-info-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">Personal Information</div>
        </div>
        <div class="modal-body">
            <div class="form-group"><label class="form-label">Full Name</label><input type="text" id="user-name" placeholder="Shrawan Kumar"></div>
            <div class="form-group"><label class="form-label">Email Address</label><input type="email" id="user-email" placeholder="shrawan@example.com"></div>
            <div class="form-group"><label class="form-label">Phone Number</label><input type="tel" id="user-phone" placeholder="+91..."></div>
            <div class="form-group"><label class="form-label">Address</label><textarea id="user-address" rows="3" placeholder="Your address..."></textarea></div>
        </div>
        <div class="modal-footer">
            <button class="primary-btn" onclick="saveUserInfo()">Save Details</button>
        </div>
    </div>
</div>

<div id="tts-modal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('tts-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('tts-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('tts-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">Voice Studio Pro</div>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Enter Text</label>
                <textarea id="tts-text" rows="4" placeholder="Type something to generate speech..."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">Select Voice Persona</label>
                <select id="tts-voice">
                    <option value="Shrawan">Shrawan</option>
                    <option value="Sunisha">Sunisha</option>
                    <option value="Rajan">Rajan</option>
                    <option value="Preety">Preety</option>
                </select>
            </div>
            <button class="primary-btn" style="width: 100%;" onclick="generateTTS()"><span class="material-icons-outlined">play_arrow</span> Play Audio</button>
        </div>
    </div>
</div>

<div id="image-modal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('image-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('image-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('image-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">Image Studio</div>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">Image Prompt</label>
                <textarea id="img-prompt" rows="3" placeholder="A futuristic city, cyberpunk style..."></textarea>
            </div>
            <button class="primary-btn" style="width: 100%;" onclick="triggerImageGen()"><span class="material-icons-outlined">palette</span> Generate Image</button>
        </div>
    </div>
</div>

<div id="video-modal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('video-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('video-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('video-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">YouTube Transcript Extractor</div>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label class="form-label">YouTube URL</label>
                <input type="text" id="video-url" placeholder="https://youtu.be/...">
            </div>
            <button class="primary-btn" style="width: 100%;" onclick="fetchTranscript()"><span class="material-icons-outlined">description</span> Get Transcript</button>
        </div>
    </div>
</div>

<div id="pricing-modal" class="modal-overlay">
    <div class="modal-card" style="max-width: 850px;">
        <div class="modal-header">
            <div class="window-controls">
                <button class="win-btn win-close" onclick="closeModal('pricing-modal')"><span class="material-icons-outlined">close</span></button>
                <button class="win-btn win-min" onclick="toggleMin('pricing-modal')"><span class="material-icons-outlined">remove</span></button>
                <button class="win-btn win-max" onclick="toggleMax('pricing-modal')"><span class="material-icons-outlined">open_in_full</span></button>
            </div>
            <div class="modal-title">Choose Your Plan</div>
        </div>
        <div class="modal-body">
            <div class="pricing-grid">
                <div class="price-card">
                    <h3 class="plan-name">Shrawan Free</h3>
                    <div class="plan-price">â‚¹0 <span style="font-size:14px; font-weight:normal; color:var(--text-sub);">/mo</span></div>
                    <ul class="plan-features">
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Basic AI Models</li>
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Standard Speed</li>
                    </ul>
                    <button class="plan-btn">Current Plan</button>
                </div>
                <div class="price-card">
                    <h3 class="plan-name">Shrawan Go</h3>
                    <div class="plan-price">â‚¹399 <span style="font-size:14px; font-weight:normal; color:var(--text-sub);">/mo</span></div>
                    <ul class="plan-features">
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> More Messaging</li>
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Basic Image Gen</li>
                    </ul>
                    <button class="plan-btn">Upgrade to Go</button>
                </div>
                <div class="price-card premium">
                    <span class="popular-tag">MOST POPULAR</span>
                    <h3 class="plan-name">Shrawan Ultra</h3>
                    <div class="plan-price">â‚¹1,999 <span style="font-size:14px; font-weight:normal; color:var(--text-sub);">/mo</span></div>
                    <ul class="plan-features">
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Priority High Speed</li>
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Advanced Vision & Voice</li>
                        <li><span class="material-icons-outlined" style="color:var(--accent-color);">check</span> Deep Research Tools</li>
                    </ul>
                    <button class="plan-btn">Get Ultra</button>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleSidebar()"></div>
<aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2 class="brand-title">ShrawanChatAI</h2>
        <button class="icon-btn" onclick="toggleSidebar()"><span class="material-icons-outlined">close</span></button>
    </div>
    
    <button class="btn-new-chat" onclick="startNewChat()">
        <span class="material-icons-outlined" style="color: var(--accent-color);">add</span> New Chat
    </button>
    
    <div class="history-section" id="history-section">
        <div class="history-label">Recent Conversations</div>
        <div id="history-list">
            </div>
    </div>

    <div class="theme-selector">
        <div class="history-label">Interface Theme</div>
        <div class="theme-btns">
            <button class="theme-btn" id="theme-dark" onclick="setTheme('dark')">Dark</button>
            <button class="theme-btn" id="theme-light" onclick="setTheme('light')">Light</button>
            <button class="theme-btn" id="theme-blue" onclick="setTheme('blue')">Blue</button>
        </div>
    </div>
</aside>

<main class="main-content">
    <header>
        <button class="icon-btn" onclick="toggleSidebar()" style="font-size: 28px;"><span class="material-icons-outlined">menu</span></button>
        
        <div class="header-right">
            <select id="model-select" class="model-selector"></select>
            
            <div style="position: relative;">
                <img src="https://ui-avatars.com/api/?name=Guest&background=random" id="header-avatar" class="profile-pic-small" onclick="toggleProfileMenu()">
                
                <div class="profile-menu" id="profile-menu">
                    <div class="profile-header">
                        <img src="" id="menu-avatar" class="profile-pic-large">
                        <h3 class="profile-name" id="menu-name">Guest User</h3>
                        <p class="profile-email" id="menu-email">Not logged in</p>
                        <button class="login-btn" id="auth-btn" onclick="handleAuth()">Sign in to Account</button>
                    </div>
                    <ul class="profile-links">
                        <li onclick="openModal('user-info-modal'); toggleProfileMenu();"><span class="material-icons-outlined">person</span> Personal Information</li>
                        <li onclick="openModal('pricing-modal'); toggleProfileMenu();"><span class="material-icons-outlined">rocket_launch</span> Upgrade to AI Ultra</li>
                        <li onclick="openModal('settings-modal'); toggleProfileMenu();"><span class="material-icons-outlined">settings</span> System Settings</li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <div class="viewport" id="viewport">
        <div id="hero" class="hero-section">
            <h1 class="shrawan-title">I Am ShrawanChatAI</h1>
            <p style="color: var(--text-sub); font-size: 15px; margin-bottom: 20px;">Your Professional AI Suite. Powered by Vision, Voice & Knowledge.</p>
            
            <div class="action-cards-container">
                <div class="action-card" onclick="openModal('tts-modal')">
                    <span class="material-icons-outlined action-card-icon">record_voice_over</span>
                    <span class="action-card-text">Voice Studio Pro</span>
                    <span class="action-card-subtext">Generate natural speech</span>
                </div>
                <div class="action-card" onclick="openModal('image-modal')">
                    <span class="material-icons-outlined action-card-icon">palette</span>
                    <span class="action-card-text">Create Image</span>
                    <span class="action-card-subtext">Visual art generator</span>
                </div>
                <div class="action-card" onclick="openModal('video-modal')">
                    <span class="material-icons-outlined action-card-icon">video_library</span>
                    <span class="action-card-text">Video to Text</span>
                    <span class="action-card-subtext">YouTube Transcripts</span>
                </div>
                <div class="action-card" onclick="activateDeepMode()">
                    <span class="material-icons-outlined action-card-icon">psychology</span>
                    <span class="action-card-text">Deep Gyan Mode</span>
                    <span class="action-card-subtext">Scholarly & detailed</span>
                </div>
            </div>
        </div>
        
        <div id="chat-flow"></div>
    </div>

    <div class="bottom-bar">
        <div class="input-box-container">
            <div id="preview-box">
                <img id="preview-img" src="">
                <button onclick="clearImage()" style="position:absolute; top:-8px; right:-8px; background:red; color:#fff; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer;">Ã—</button>
            </div>
            <div class="input-box">
                <button class="icon-btn adam-voice-btn" id="adam-trigger" onclick="handleVoicePlayback()" title="Replay AI Voice">
                    <span class="material-icons-outlined" style="font-size: 26px;">volume_up</span>
                </button>
                
                <textarea id="user-input" rows="1" placeholder="Ask anything to ShrawanChatAI..." oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px';"></textarea>
                
                <div class="input-actions">
                    <input type="file" id="img-upload" accept="image/*" hidden onchange="handleImageUpload(event)">
                    <button class="icon-btn" onclick="document.getElementById('img-upload').click()" title="Upload Image"><span class="material-icons-outlined">add_photo_alternate</span></button>
                    <button class="icon-btn" id="mic-btn" onclick="startSTT()" title="Voice Input"><span class="material-icons-outlined">mic</span></button>
                    <button class="icon-btn" style="background: var(--accent-color); color: #fff;" onclick="sendMessage()" title="Send"><span class="material-icons-outlined" style="font-size: 20px;">send</span></button>
                </div>
            </div>
        </div>
    </div>
</main>

<script>
    // --- Configure Professional Markdown Parser ---
    marked.setOptions({ breaks: true, gfm: true });

    // --- STATE MANAGEMENT ---
    let state = {
        apiKey: localStorage.getItem('shrawan_key1') || "",
        apiKey2: localStorage.getItem('shrawan_key2') || "",
        models: JSON.parse(localStorage.getItem('shrawan_models')) || ["google/gemini-2.0-flash-lite-preview-02-05:free"],
        theme: localStorage.getItem('shrawan_theme') || 'dark',
        isLoggedIn: localStorage.getItem('shrawan_logged_in') === 'true',
        userInfo: JSON.parse(localStorage.getItem('shrawan_user_info')) || { name: 'Guest', email: '', phone: '', address: '' },
        chatHistory: JSON.parse(localStorage.getItem('shrawan_chat_history')) || [],
        currentImage: null,
        isDeepMode: false,
        lastAiResponse: "",
        synth: window.speechSynthesis
    };

    // --- INITIALIZATION ---
    window.onload = () => {
        applyTheme(state.theme);
        loadSettingsUI();
        updateAuthUI();
        populateModelDropdown();
        renderChatHistory();
        if (!state.apiKey) openModal('settings-modal');
        
        document.getElementById('user-input').addEventListener('keydown', (e) => {
            if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMessage(); }
        });
    };

    // --- UI, WINDOW & MODAL LOGIC ---
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); document.getElementById('sidebar-overlay').classList.toggle('active'); }
    function openModal(id) { 
        const m = document.getElementById(id);
        m.classList.add('active'); 
        m.querySelector('.modal-card').classList.remove('minimized', 'maximized');
    }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function toggleMin(id) {
        const card = document.querySelector(`#${id} .modal-card`);
        card.classList.remove('maximized');
        card.classList.toggle('minimized');
    }
    function toggleMax(id) {
        const card = document.querySelector(`#${id} .modal-card`);
        card.classList.remove('minimized');
        card.classList.toggle('maximized');
    }
    function toggleProfileMenu() {
        const menu = document.getElementById('profile-menu');
        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }
    document.addEventListener('click', (e) => { if (!e.target.closest('.header-right')) document.getElementById('profile-menu').style.display = 'none'; });

    function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('shrawan_theme', theme);
        state.theme = theme;
        document.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
        document.getElementById(`theme-${theme}`).classList.add('active');
    }
    function setTheme(t) { applyTheme(t); toggleSidebar(); }

    function startNewChat() {
        if(state.synth.speaking) state.synth.cancel();
        document.getElementById('chat-flow').innerHTML = '';
        document.getElementById('hero').style.display = 'flex';
        clearImage(); toggleSidebar();
    }
    function scrollToBottom() { const v = document.getElementById('viewport'); v.scrollTo({ top: v.scrollHeight, behavior: 'smooth' }); }

    // --- AUTH, PROFILE & HISTORY (Restored) ---
    function updateAuthUI() {
        const avatarUrl = state.isLoggedIn 
            ? `https://ui-avatars.com/api/?name=${encodeURIComponent(state.userInfo.name)}&background=3b82f6&color=fff`
            : "https://ui-avatars.com/api/?name=Guest&background=random";
        
        document.getElementById('header-avatar').src = avatarUrl;
        document.getElementById('menu-avatar').src = avatarUrl;
        document.getElementById('menu-name').innerText = state.isLoggedIn ? state.userInfo.name : "Guest User";
        document.getElementById('menu-email').innerText = state.isLoggedIn ? state.userInfo.email : "Not logged in";
        document.getElementById('auth-btn').innerText = state.isLoggedIn ? "Sign Out" : "Sign in to Account";
        document.getElementById('history-section').style.display = state.isLoggedIn ? 'block' : 'none';

        if(state.isLoggedIn) {
            document.getElementById('user-name').value = state.userInfo.name || '';
            document.getElementById('user-email').value = state.userInfo.email || '';
            document.getElementById('user-phone').value = state.userInfo.phone || '';
            document.getElementById('user-address').value = state.userInfo.address || '';
        }
    }

    function handleAuth() {
        state.isLoggedIn = !state.isLoggedIn;
        localStorage.setItem('shrawan_logged_in', state.isLoggedIn);
        if(!state.isLoggedIn) state.userInfo = { name: 'Guest', email: '', phone: '', address: '' };
        updateAuthUI(); toggleProfileMenu();
    }

    function saveUserInfo() {
        state.userInfo = {
            name: document.getElementById('user-name').value.trim() || 'User',
            email: document.getElementById('user-email').value.trim(),
            phone: document.getElementById('user-phone').value.trim(),
            address: document.getElementById('user-address').value.trim()
        };
        localStorage.setItem('shrawan_user_info', JSON.stringify(state.userInfo));
        updateAuthUI(); closeModal('user-info-modal');
    }

    function saveToHistory(text) {
        if(!state.isLoggedIn) return;
        const summary = text.substring(0, 30) + '...';
        state.chatHistory.unshift({ id: Date.now(), summary: summary });
        if(state.chatHistory.length > 20) state.chatHistory.pop();
        localStorage.setItem('shrawan_chat_history', JSON.stringify(state.chatHistory));
        renderChatHistory();
    }
    function renderChatHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = '';
        state.chatHistory.forEach(item => {
            let div = document.createElement('div');
            div.className = 'history-item';
            div.innerHTML = `<span class="material-icons-outlined" style="font-size:16px;">chat_bubble_outline</span> ${item.summary}`;
            list.appendChild(div);
        });
    }

    // --- SETTINGS ---
    function loadSettingsUI() {
        document.getElementById('api-key-1').value = state.apiKey;
        document.getElementById('api-key-2').value = state.apiKey2;
        for(let i=0; i<3; i++) if(document.getElementById(`model-${i+1}`)) document.getElementById(`model-${i+1}`).value = state.models[i] || '';
    }
    function saveSettings() {
        state.apiKey = document.getElementById('api-key-1').value.trim();
        state.apiKey2 = document.getElementById('api-key-2').value.trim();
        state.models = [];
        for(let i=1; i<=3; i++) {
            let val = document.getElementById(`model-${i}`).value.trim();
            if(val) state.models.push(val);
        }
        if(state.models.length === 0) state.models.push("google/gemini-2.0-flash-lite-preview-02-05:free");
        
        localStorage.setItem('shrawan_key1', state.apiKey);
        localStorage.setItem('shrawan_key2', state.apiKey2);
        localStorage.setItem('shrawan_models', JSON.stringify(state.models));
        populateModelDropdown(); closeModal('settings-modal');
    }
    function populateModelDropdown() {
        const select = document.getElementById('model-select');
        select.innerHTML = '';
        state.models.forEach(model => {
            let option = document.createElement('option');
            option.value = model; option.text = model.split('/').pop();
            select.appendChild(option);
        });
    }

    // --- ADVANCED FEATURES (TTS, Image, Video, Deep Gyan) ---
    
    function activateDeepMode() {
        state.isDeepMode = true;
        document.getElementById('user-input').placeholder = "Deep Gyan Mode: Ask complex questions...";
        alert("ðŸ§  Deep Gyan Mode ON: Answers will be highly detailed and professional.");
    }

    function generateTTS() {
        const text = document.getElementById('tts-text').value.trim();
        const voiceName = document.getElementById('tts-voice').value;
        if(!text) return alert("Please enter text.");
        
        state.synth.cancel();
        let utterance = new SpeechSynthesisUtterance(text);
        
        let voices = state.synth.getVoices();
        let targetVoice;
        
        // Smart matching logic for Indian names without exposing "Hindi/English" in UI
        if(voiceName === "Shrawan" || voiceName === "Rajan") {
            targetVoice = voices.find(v => v.lang.includes('hi') && v.name.includes('Male')) || voices.find(v => v.lang.includes('hi'));
        } else if (voiceName === "Sunisha" || voiceName === "Preety") {
            targetVoice = voices.find(v => v.lang.includes('hi') && v.name.includes('Female')) || voices.find(v => v.lang.includes('hi'));
        }
        
        if(!targetVoice) targetVoice = voices.find(v => v.lang.includes('en')); // Fallback
        if(targetVoice) utterance.voice = targetVoice;
        utterance.rate = 0.95; 
        
        state.synth.speak(utterance);
    }

    function triggerImageGen() {
        const prompt = document.getElementById('img-prompt').value.trim();
        if(!prompt) return;
        closeModal('image-modal');
        document.getElementById('hero').style.display = 'none';
        const chatFlow = document.getElementById('chat-flow');
        chatFlow.style.display = 'flex';
        
        appendMessage('user', `Generate image: ${prompt}`);
        
        // Direct Render Bypass (Pollinations)
        const encodedPrompt = encodeURIComponent(prompt);
        const imgUrl = `https://image.pollinations.ai/prompt/${encodedPrompt}?nologo=true&enhance=true`;
        
        const loadingId = 'loading-' + Date.now();
        appendMessage('bot', '<span style="color:var(--text-sub);">Rendering art...</span>', loadingId);
        
        setTimeout(() => {
            document.getElementById(loadingId).innerHTML = `Here is your generated image:<br><br><img src="${imgUrl}" style="max-width:100%; border-radius:12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">`;
            scrollToBottom();
        }, 1500);
        document.getElementById('img-prompt').value = '';
    }

    function fetchTranscript() {
        const url = document.getElementById('video-url').value.trim();
        if(!url) return;
        closeModal('video-modal');
        document.getElementById('user-input').value = `Please provide a detailed transcript and summary for this video URL: ${url}`;
        sendMessage();
    }

    // --- CORE AI CHAT (With Professional Markdown) ---

    function handleImageUpload(e) {
        const file = e.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (f) => {
            state.currentImage = f.target.result;
            document.getElementById('preview-img').src = state.currentImage;
            document.getElementById('preview-box').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
    function clearImage() { state.currentImage = null; document.getElementById('preview-box').style.display = 'none'; document.getElementById('img-upload').value = ''; }

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if(!text && !state.currentImage) return;
        if(!state.apiKey) return openModal('settings-modal');

        const model = document.getElementById('model-select').value;
        
        document.getElementById('hero').style.display = 'none';
        const chatFlow = document.getElementById('chat-flow');
        chatFlow.style.display = 'flex';
        
        let userHtml = text.replace(/\n/g, '<br>');
        if(state.currentImage) userHtml += `<br><img src="${state.currentImage}" style="max-width:200px; border-radius:8px; margin-top:10px;">`;
        appendMessage('user', userHtml);
        
        if(chatFlow.children.length === 1) saveToHistory(text || "Image Scan");

        input.value = ''; input.style.height = 'auto'; input.placeholder = "Ask anything...";
        
        const loadingId = 'loading-' + Date.now();
        appendMessage('bot', '<span style="color:var(--accent-color);">Thinking...</span>', loadingId);

        let sysPrompt = state.isDeepMode 
            ? "You are ShrawanChatAI in Deep Gyan mode. Provide highly extensive, scholarly, and professional answers. Use Markdown formatting extensively (tables, lists, bold). Mix Hindi and English."
            : "You are ShrawanChatAI, a professional assistant. Answer perfectly. Mix Hindi and English. Format using Markdown.";

        let userContent = text;
        if(state.currentImage) {
            userContent = [{type: "text", text: text || "Analyze image"}, {type: "image_url", image_url: {url: state.currentImage}}];
        }

        const payload = { model: model, messages: [{role: "system", content: sysPrompt}, {role: "user", content: userContent}] };
        clearImage(); state.isDeepMode = false;

        try {
            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: { "Authorization": `Bearer ${state.apiKey}`, "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            if(!res.ok) throw new Error(`API Error ${res.status}`);
            const data = await res.json();
            const rawReply = data.choices[0].message.content;
            state.lastAiResponse = rawReply;
            
            // Professional Markdown Rendering
            document.getElementById(loadingId).innerHTML = marked.parse(rawReply);
        } catch (error) {
            document.getElementById(loadingId).innerHTML = `<span style="color:#ff5f56;">Error: ${error.message}. Please check API keys.</span>`;
        }
        scrollToBottom();
    }

    function appendMessage(sender, content, id = null) {
        const chatFlow = document.getElementById('chat-flow');
        const row = document.createElement('div');
        row.className = `msg-row ${sender}`;
        row.innerHTML = `<div class="msg-bubble" ${id ? `id="${id}"` : ''}>${content}</div>`;
        chatFlow.appendChild(row);
        scrollToBottom();
    }

    // --- STT & VOICE PLAYBACK ---
    function handleVoicePlayback() {
        if(!state.lastAiResponse) return;
        if(state.synth.speaking) { state.synth.cancel(); return; }
        
        const utterance = new SpeechSynthesisUtterance(state.lastAiResponse.replace(/(<([^>]+)>)/gi, "").replace(/[*#_`]/g, ''));
        const voices = state.synth.getVoices();
        const preferredVoice = voices.find(v => v.lang.includes('hi')) || voices.find(v => v.lang.includes('en'));
        if(preferredVoice) utterance.voice = preferredVoice;
        
        utterance.onstart = () => document.getElementById('adam-trigger').style.color = 'var(--accent-color)';
        utterance.onend = () => document.getElementById('adam-trigger').style.color = 'var(--text-sub)';
        state.synth.speak(utterance);
    }

    function startSTT() {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if(!SpeechRecognition) return alert("Voice input not supported in this browser.");
        const rec = new SpeechRecognition();
        rec.lang = 'hi-IN';
        rec.onstart = () => document.getElementById('mic-btn').style.color = 'red';
        rec.onend = () => document.getElementById('mic-btn').style.color = 'var(--text-sub)';
        rec.onresult = (e) => { 
            document.getElementById('user-input').value += e.results[0][0].transcript + ' '; 
            sendMessage(); 
        };
        rec.start();
    }

</script>
</body>
</html>
