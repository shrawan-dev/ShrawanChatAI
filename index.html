<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>RealChat AI</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root {
--bg-dark: #131314; --sidebar-bg: #1e1f20; --input-bg: #1e1f20;
--text-main: #e3e3e3; --text-sub: #c4c7c5; --accent-blue: #8ab4f8;
}

* { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, sans-serif; }
body { background: var(--bg-dark); color: var(--text-main); height: 100dvh; overflow: hidden; display: flex; }

.sidebar { position: fixed; left: -300px; top: 0; width: 280px; height: 100%; background: var(--sidebar-bg); transition: 0.3s ease; z-index: 1000; padding: 15px; display: flex; flex-direction: column; box-shadow: 5px 0 20px rgba(0,0,0,0.5); }
.sidebar.active { left: 0; }
.sidebar-header { display: flex; align-items: center; margin-bottom: 20px; }
.btn-new { background: #28292a; border: none; color: white; padding: 10px 18px; border-radius: 50px; cursor: pointer; display: flex; align-items: center; gap: 8px; margin-left: 10px; font-size: 14px; }

.history-list { flex: 1; overflow-y: auto; margin-top: 10px; }
.history-item { padding: 12px; border-radius: 8px; font-size: 14px; cursor: pointer; color: var(--text-sub); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; }
.history-item:hover { background: #333537; color: white; }

.settings-btn { background: transparent; color: var(--text-sub); border: 1px solid #3c4043; padding: 10px; border-radius: 8px; cursor: pointer; margin-top: auto; display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; }

.main-stage { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; }
header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
.icon-btn { color: var(--text-sub); background: none; border: none; cursor: pointer; padding: 6px; border-radius: 50%; display: flex; align-items: center; transition: 0.2s; flex-shrink: 0; }
.icon-btn:hover { background: #333537; color: white; }

.viewport { flex: 1; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; scroll-behavior: smooth; }
.welcome-screen { width: 100%; max-width: 800px; margin-top: 5vh; text-align: center; }
.gradient-text { font-size: clamp(32px, 8vw, 56px); font-weight: bold; background: linear-gradient(to right, #4285f4, #d96570); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.sub-greeting { font-size: clamp(20px, 5vw, 30px); color: #444746; font-weight: bold; margin-bottom: 30px; }

#chat-flow { width: 100%; max-width: 800px; display: none; flex-direction: column; gap: 30px; padding-bottom: 120px; }
.msg { font-size: 16px; line-height: 1.6; max-width: 90%; word-wrap: break-word; }
.user-msg { align-self: flex-end; background: #2b2c2d; padding: 12px 20px; border-radius: 22px; color: white; }
.bot-msg { align-self: flex-start; color: var(--text-main); padding-right: 20px; }
.typing { color: var(--accent-blue); font-style: italic; animation: pulse 1.5s infinite; }
.chat-image { max-width: 100%; border-radius: 12px; margin-top: 10px; display: block; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }

.dl-btn { background:#28292a; color:#c4c7c5; border:1px solid #3c4043; padding:8px 15px; border-radius:20px; cursor:pointer; margin-top:10px; display:inline-flex; align-items:center; gap:5px; font-size:13px; transition: 0.2s; }
.dl-btn:hover { background: #333537; border-color: #8ab4f8; color: white; }

.bottom-nav { position: fixed; bottom: 20px; width: 100%; display: flex; flex-direction: column; align-items: center; padding: 0 10px; }
#image-preview-container { display: none; width: 100%; max-width: 800px; margin-bottom: 10px; position: relative; }
#image-preview { height: 60px; border-radius: 8px; border: 2px solid #3c4043; }
.remove-img-btn { position: absolute; top: -5px; left: 75px; background: #d93025; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; }

.input-container { background: var(--input-bg); border-radius: 35px; padding: 6px 10px; display: flex; align-items: center; gap: 4px; width: 100%; max-width: 800px; border: 1px solid #3c4043; box-shadow: 0 4px 15px rgba(0,0,0,0.5); overflow: hidden; }
#user-input { flex: 1; min-width: 0; background: transparent; border: none; color: white; outline: none; font-size: 15px; padding: 10px 5px; }

.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; justify-content: center; align-items: center; }
.modal-box { background: var(--sidebar-bg); padding: 25px; border-radius: 15px; width: 90%; max-width: 400px; border: 1px solid #3c4043; }
.modal-input { width: 100%; padding: 12px; margin-bottom: 20px; background: var(--bg-dark); border: 1px solid #5f6368; color: white; border-radius: 8px; outline: none; }
.modal-btn { background: #4285f4; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; font-size: 16px; }

@keyframes pulse { 0% { opacity: 0.5; } 50% { opacity: 1; } 100% { opacity: 0.5; } }
</style>
</head>
<body>

<div id="settings-modal" class="modal-overlay">
<div class="modal-box">
<h2 style="text-align: center; margin-bottom: 15px;">‚öôÔ∏è Setup</h2>
<label style="font-size: 13px; color: var(--text-sub);">OpenRouter API Key:</label>
<input type="password" id="api-key-input" class="modal-input" placeholder="sk-or-v1-...">
<label style="font-size: 13px; color: var(--text-sub);">Model:</label>
<input type="text" id="model-input" class="modal-input" value="google/gemini-2.0-flash-lite-preview-02-05:free">
<button class="modal-btn" onclick="saveSettings()">Start Chatting</button>
</div>
</div>

<aside id="sidebar" class="sidebar">
<div class="sidebar-header">
<button class="icon-btn" onclick="toggleSidebar()"><span class="material-icons">menu</span></button>
<button class="btn-new" onclick="location.reload()"><span class="material-icons">add</span> New chat</button>
</div>
<div class="history-list" id="history-items"></div>
<button class="settings-btn" onclick="openSettings()"><span class="material-icons">settings</span> Settings</button>
</aside>

<div class="main-stage">
<header>
<button class="icon-btn" onclick="toggleSidebar()"><span class="material-icons">menu</span></button>
</header>

<div class="viewport">
<div id="welcome-ui" class="welcome-screen">
<h1 class="gradient-text">RealChat AI</h1>
<p style="color: var(--text-sub); font-size: 14px; margin-top: 20px;">Voice Commands ‚Ä¢ HD Image Generation ‚Ä¢ High Speed</p>
</div>
<div id="chat-flow"></div>
</div>

<div class="bottom-nav">
<div id="image-preview-container">
<button class="remove-img-btn" onclick="removeImage()">‚úñ</button>
<img id="image-preview" src="" alt="preview">
</div>

<div class="input-container">
<input type="file" id="file-input" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
<button class="icon-btn" onclick="document.getElementById('file-input').click()" title="Upload Image">
<span class="material-icons">photo_library</span>
</button>

<button class="icon-btn" onclick="triggerImageMode()" title="Create Image" style="color: #fbbc04;">
<span class="material-icons">brush</span>
</button>

<input type="text" id="user-input" placeholder="Message..." onkeypress="if(event.key==='Enter') startChat()">

<button class="icon-btn" id="mic-btn" onclick="startVoiceTyping()" title="Tap to Speak">
<span class="material-icons">mic</span>
</button>

<button class="icon-btn" id="voice-toggle-btn" onclick="toggleVoice()" title="Play/Stop Voice">
<span class="material-icons">volume_up</span>
</button>

<button class="icon-btn" onclick="startChat()" style="color: var(--accent-blue);">
<span class="material-icons">send</span>
</button>
</div>
</div>
</div>

<script>
let currentApiKey = localStorage.getItem('rc_apikey') || "";
let currentModel = localStorage.getItem('rc_model') || "google/gemini-2.0-flash-lite-preview-02-05:free";
let currentBase64Image = null;
let isSpeaking = false;

let systemVoices = [];
window.speechSynthesis.onvoiceschanged = () => { systemVoices = window.speechSynthesis.getVoices(); };

window.onload = function() {
if (!currentApiKey) openSettings();
systemVoices = window.speechSynthesis.getVoices();
};

function openSettings() {
document.getElementById('api-key-input').value = currentApiKey;
document.getElementById('model-input').value = currentModel;
document.getElementById('settings-modal').style.display = 'flex';
toggleSidebar(false);
}

function saveSettings() {
currentApiKey = document.getElementById('api-key-input').value.trim();
currentModel = document.getElementById('model-input').value.trim();
localStorage.setItem('rc_apikey', currentApiKey);
localStorage.setItem('rc_model', currentModel);
document.getElementById('settings-modal').style.display = 'none';
}

function toggleSidebar(force) {
const sidebar = document.getElementById('sidebar');
sidebar.classList.toggle('active', force ?? !sidebar.classList.contains('active'));
}

function startVoiceTyping() {
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
if (!SpeechRecognition) {
alert("Aapka browser Voice Typing support nahi karta.");
return;
}

const micBtn = document.getElementById('mic-btn');
const recognition = new SpeechRecognition();
recognition.lang = 'hi-IN';
recognition.interimResults = false;

recognition.onstart = function() {
micBtn.style.color = '#d93025';
document.getElementById('user-input').placeholder = "Sun raha hoon...";
};

recognition.onresult = function(event) {
const text = event.results[0][0].transcript;
document.getElementById('user-input').value = text;
micBtn.style.color = 'var(--text-sub)';
document.getElementById('user-input').placeholder = "Message...";
startChat();
};

recognition.onerror = function(event) {
micBtn.style.color = 'var(--text-sub)';
document.getElementById('user-input').placeholder = "Message...";
};

recognition.start();
}

function triggerImageMode() {
const input = document.getElementById('user-input');
input.value = "/image ";
input.focus();
}

function handleImageUpload(event) {
const file = event.target.files[0];
if (file) {
const reader = new FileReader();
reader.onload = (e) => {
currentBase64Image = e.target.result;
document.getElementById('image-preview').src = currentBase64Image;
document.getElementById('image-preview-container').style.display = 'block';
};
reader.readAsDataURL(file);
}
}

function removeImage() {
currentBase64Image = null;
document.getElementById('image-preview-container').style.display = 'none';
document.getElementById('file-input').value = "";
}

async function startChat() {
if (!currentApiKey) { openSettings(); return; }
const input = document.getElementById('user-input');
const text = input.value.trim();
if (!text && !currentBase64Image) return;

input.blur();

document.getElementById('welcome-ui').style.display = 'none';
const chatFlow = document.getElementById('chat-flow');
chatFlow.style.display = 'flex';

let userHTML = `<div class="msg user-msg">`;
if (text) userHTML += `<div>${text}</div>`;
if (currentBase64Image) userHTML += `<img src="${currentBase64Image}" class="chat-image" style="width:150px;">`;
userHTML += `</div>`;
chatFlow.innerHTML += userHTML;
input.value = '';

const histItem = document.createElement('div');
histItem.className = 'history-item';
histItem.innerText = text ? text.substring(0, 20) + "..." : "Photo...";
document.getElementById('history-items').prepend(histItem);

const botDiv = document.createElement('div');
botDiv.className = 'msg bot-msg';
chatFlow.appendChild(botDiv);
scrollToBottom();

const lowerText = text.toLowerCase();

// --- 1. SHRAWAN JI OWNER CHECK ---
if (lowerText.includes("woner kaun hai") || lowerText.includes("owner kaun hai") || lowerText.includes("who is your owner") || lowerText.includes("who is your woner") || lowerText.includes("woner kon hai")) {
botDiv.innerHTML = `<b>RealChat</b><br>Mere owner <b>Shrawan Ji</b> hain! Unhone hi mujhe banaya hai. Main unka banaya hua AI Assistant hoon. üòé`;
scrollToBottom();
return;
}

// --- 2. IMAGE GENERATOR FIX (Robust Direct HTML Injection) ---
if (lowerText.startsWith('/image') || lowerText.includes('/image')) {
let promptText = text.replace(/\/image/i, '').trim() || "A highly detailed futuristic city";

const checkString = promptText.toLowerCase();
if ((checkString.includes('woman') || checkString.includes('women') || checkString.includes('mahila') || checkString.includes('ladki') || checkString.includes('girl')) &&
(checkString.includes('clothes') || checkString.includes('kapde') || checkString.includes('dress') || checkString.includes('wear') || checkString.includes('change'))) {
botDiv.innerHTML = `<b>RealChat</b><br>Main mahilaon ke kapdon se sambandhit anurodhon ko mana kar dunga, kyunki har mahila ki garima mahatvapurna hai.`;
scrollToBottom();
removeImage(); return;
}

const seed = Math.floor(Math.random() * 999999);
const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(promptText)}?width=1024&height=1024&seed=${seed}&nologo=true`;

// FIX: Direct HTML injection is more reliable than new Image() onload
botDiv.innerHTML = `
<b>RealChat</b><br>
<img src="${imageUrl}" class="chat-image" alt="Generated Image" onerror="this.onerror=null; this.src='https://placehold.co/600x400?text=Image+Generation+Failed'; this.style.border='2px solid red';">
<button onclick="window.open('${imageUrl}', '_blank')" class="dl-btn">
<span class="material-icons" style="font-size:16px;">download</span> Download HD
</button>
`;
scrollToBottom();

removeImage(); return;
}

// --- 3. TEXT CHAT LOGIC ---
botDiv.innerHTML = `<b>RealChat</b><br><span class="typing">Thinking...</span>`;
scrollToBottom();

let apiMessages = [];
apiMessages.push({
"role": "system",
"content": "You are RealChat, created by Shrawan Ji. You give highly energetic, friendly, deep, and beautifully human-like responses in Hindi and English. If the user asks for detailed information or stories, generate an extremely long, comprehensive, and unique response. Respect the dignity of women unconditionally."
});

if(currentBase64Image) {
apiMessages.push({ "role": "user", "content": [ { "type": "text", "text": text || "Explain this image in high detail." }, { "type": "image_url", "image_url": { "url": currentBase64Image } } ] });
} else {
apiMessages.push({ "role": "user", "content": text });
}

removeImage();

let models = [currentModel, "google/gemini-2.0-flash-lite-preview-02-05:free", "deepseek/deepseek-r1:free"];
models = [...new Set(models)];

for (let modelId of models) {
try {
const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
method: "POST",
headers: { "Authorization": `Bearer ${currentApiKey}`, "Content-Type": "application/json", "HTTP-Referer": window.location.href },
body: JSON.stringify({
"model": modelId,
"messages": apiMessages,
"max_tokens": 8000
})
});
const data = await response.json();
if (data.choices?.[0]?.message?.content) {
const reply = data.choices[0].message.content;
const shortText = reply.substring(0, 190);
const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(shortText)}&tl=hi-IN&client=tw-ob`;

botDiv.innerHTML = `
<b>RealChat</b><br>${reply.replace(/\n/g, '<br>')}
<br>
<button onclick="window.open('${audioUrl}', '_blank')" class="dl-btn">
<span class="material-icons" style="font-size:16px;">audiotrack</span> Save Audio Snippet
</button>
`;
scrollToBottom();
return;
}
} catch (err) { console.warn(`Failed: ${modelId}`); }
}
botDiv.innerHTML = "<b>System:</b> All models busy. Try again.";
}

function scrollToBottom() {
const viewport = document.querySelector('.viewport');
viewport.scrollTop = viewport.scrollHeight;
}

function speakText(text) {
window.speechSynthesis.cancel();
const utter = new SpeechSynthesisUtterance(text);
utter.lang = 'hi-IN';

let maleVoice = systemVoices.find(v => v.name.toLowerCase().includes('male') || v.name.toLowerCase().includes('ravi'));
if(maleVoice) utter.voice = maleVoice;

utter.pitch = 0.6;
utter.rate = 1.1;

utter.onstart = () => {
isSpeaking = true;
document.getElementById('voice-toggle-btn').innerHTML = '<span class="material-icons" style="color:#d93025;">volume_off</span>';
};
utter.onend = () => {
isSpeaking = false;
document.getElementById('voice-toggle-btn').innerHTML = '<span class="material-icons">volume_up</span>';
};
utter.onerror = utter.onend;

window.speechSynthesis.speak(utter);
}

function toggleVoice() {
if (isSpeaking || window.speechSynthesis.speaking) {
window.speechSynthesis.cancel();
isSpeaking = false;
document.getElementById('voice-toggle-btn').innerHTML = '<span class="material-icons">volume_up</span>';
} else {
const msgs = document.querySelectorAll('.bot-msg');
if (msgs.length > 0) {
let cleanText = msgs[msgs.length - 1].innerText.replace('RealChat', '').replace('Save Audio Snippet', '').replace('Download HD', '').trim();
speakText(cleanText);
}
}
}
</script>
</body>
</html>
